<!doctype html><html lang=en dir=auto><head><script src="//livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | langhaidian</title>
<meta name=keywords content><meta name=description content="Posts - langhaidian"><meta name=author content="Me"><link rel=canonical href=http://localhost:1313//posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=//assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://avatars.githubusercontent.com/u/539272><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://localhost:1313//posts/index.xml><link rel=alternate hreflang=en href=http://localhost:1313//posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313//posts/"><meta property="og:site_name" content="langhaidian"><meta property="og:title" content="Posts"><meta property="og:description" content="ExampleSite description"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Posts"><meta name=twitter:description content="ExampleSite description"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313//posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/favicon.ico alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives/ title=归档><span>归档</span></a></li><li><a href=http://localhost:1313/tags/ title=标签><span>标签</span></a></li><li><a href=http://localhost:1313/about/ title=关于><span>关于</span></a></li><li><a href=https://langhaidian.github.io/running_page title=running_page><span>running_page</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a></div><h1>Posts
<a href=/posts/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>blog开启评论模块</h2></header><div class=entry-content><p>Loveit开启评论 loveit自带的有Giscus的配置，首先我们通过配置仓库来开启评论模块
1.在仓库中开启评论系统 找到Settings -> General -> Features -> Discussions 勾选，为仓库启动 Discussions 功能 ，如下图： 2. 使配置好的仓库安装 Giscus 点击这里，我们将会看到下面的界面，我们点击安装 点击安装后，要选择一个仓库，如下图，选择我们之前创造的仓库即可 3.从官网获取配置信息 接下来，我们只需到 Giscus 官网获取配置信息，然后将配置信息填到 Hugo 的配置文件中即可。但是由于主题的不同，所以配置文件的填写也不同，这里以 LoveIt 为例。
来到 Giscus 官网
填写你的仓库名，如下图：
选择页面与嵌入的 discussion 之间的映射关系，如下图： 直接选第一个就行
选择 Discussion 分类，如下图： 我们选择 Announcements 类型即可，官方也是这样推荐的，因为这样便于管理。
其他选项默认，我们往下滑，找到配置文件，如下图：
我们要记下data-repo，data-repo-id，data-category，data-category-id，data-mapping这几个值。
修改 Hugo 配置文件 打开配置文件config.toml，找到# 评论系统设置的第一个 enable 参量，将其改为 true，如下图： 到# giscus comment 评论系统设置,并把其配置按照下面代码块修改。
[params.page.comment.giscus] # 你可以参考官方文档来使用下列配置 enable = true repo = "&lt;your_repo>" repoId = "&lt;your_repoId>" category = "&lt;your_category>" categoryId = "&lt;your_categoryId>" # &lt;your_repo> 对应官网的 data-repo # &lt;your_repoId> 对应官网的 data-repo-id # &lt;your_category> 对应官网的 data-category # &lt;your_categoryId> 对应官网的 data-category-id # 为空时自动适配当前主题 i18n 配置 lang = "" mapping = "&lt;your_mapping>" # &lt;your_mapping> 对应官网的 data-mapping reactionsEnabled = "1" emitMetadata = "0" inputPosition = "bottom" lazyLoading = false lightTheme = "light" darkTheme = "dark_dimmed" 配置好后,就可以开启 Giscus 评论系统了。
...</p></div><footer class=entry-footer><span title='2024-03-10 11:04:49 +0800 CST'>March 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;124 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to blog开启评论模块" href=http://localhost:1313//posts/other/%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%90%AF%E8%AF%84%E8%AE%BA%E6%A8%A1%E5%9D%97/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>tomcat设置系统服务</h2></header><div class=entry-content><p>编辑系统服务
vi /etc/systemd/system/tomcat.service [Unit] Description=Tomcat8540 After=syslog.target network.target remote-fs.target nss-lookup.target [Service] Type=oneshot ExecStart=/usr/local/apache-tomcat-8.5.40/bin/startup.sh ExecStop=/usr/local/apache-tomcat-8.5.40/bin/shutdown.sh ExecReload=/bin/kill -s HUP $MAINPID RemainAfterExit=yes [Install] WantedBy=multi-user.target 设置开机启动
systemctl enable tomcat 启动服务
systemctl start tomcat</p></div><footer class=entry-footer><span title='2024-03-10 11:04:49 +0800 CST'>March 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;28 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to tomcat设置系统服务" href=http://localhost:1313//posts/linux/tomcat%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>操作系统级故障总结</h2></header><div class=entry-content><p>西安管线项目操作系统级故障报告 1. 发生时间 2023-06-09 2. 故障现象 主要数据库15服务器，操作系统进入只读模式，导致无法进行其余操作。系操作系统文件损坏，属于基础环境层问题，与应用层无关。 3. 处理情况 已使用操作系统自带修复工具修复系统文件损坏，目前操作系统使用正常。 4. 事件回顾 接院方通知2023-06-09通知礼拜天机房要停电，需要对相关服务器进行关机操作，下班之时对管线系统部署的19、15服务器进行关机操作。19服务器停止软件服务关机正常，15服务器停止软件服务时，提示"sudo docker-compose down XXXXXXX: Read-only file system"，服务无法停止无论做何种操作都是此提示，怀疑是磁盘占用已满检查后磁盘占用正常。经重启之后提示如下： 查阅官方资料、互联网结果是操作系统文件丢失或者损坏导致操作系统出现问题。因停电缘故修复工作放置上班时间。2023-06-10突然接到通知需要进行演示汇报工作，随即到达院现场开展修复工作和备用服务器启用工作。 5. 修复处理及原因 5.1 备用服务器启用 开始启用44、43服务器当作临时演示服务器使用，重启中发现数据盘挂载与操作系统目录冲突原因导致挂载失败，进入操作系统急救模式，取消自动挂载。编辑nano /etc/fstab文件取消自动挂在错误数据盘，重启正常进入系统，再次手动处理数据盘挂载，先使应用程序运行起来，数据盘挂载问题需要后期重新数据盘挂载。在使用中发现44服务器偶有界面卡死情况出现，其中2023-06-10系统测试中出现一次，怀疑跟操作系统桌面及数据盘挂载方式错误有关，需后期调整服务器和相关配置，再次检验服务器状态。 5.2 15数据库服务器修复 修复系统损坏文件。 按照提示采用fscl -y /dev/mapper/debian01--vg-root命令对操作系统损坏文件进行修复，执行完成之后正常进入系统，检查系统可正常使用。 修复journald服务文件。 启动管线程序时提示xxxx systemd-journald[xxxx]: Failed to write entry (19 items, 505 bytes), ignoring: Cannot assign requested address大量提示，经检查是操作自带journald服务写日志错误，系操作系统文件损坏导致此服务纪录出错。 通过 journalctl –verify 命令找到损坏journalctl文件，移动损坏的文件。 重启启动 systemd-journald 服务即可正常启动应用程序 sudo systemctl restart systemd-journald.service 通过dmesg命令检查，再无相关错误 重启启动管线服务正常。 修复postgrs 11 数据损坏文件。 经检查数据库启动日志信息，发现postgres11 数据库盘也有出现损坏情况，按照提示使用e2fsck -a -y /de/vgdata对损坏磁盘进行修复，数据库恢复正常。经检查sde空间库修复之后无数据，怀疑为数据库表损坏导致需后期排查。 利用备份数据还原数据库。 备份恢复为最有效解决方案，检查脚本最近期备份为 2023-06-07 差两天业务数据，经同意使用此备份进行恢复处理。 备份dxgx_xian(业务)、sde_dxgx(空间库)数据库，并修改数据库名称与原数据库名不冲突即可。 进入postgres容器内利用数据库自带脚本进行备份恢复处理 shell > sudo docker exec -it postgres bash # 进入postgres容器 shell > su postgres # 切换到postgres账户 shell > createdb dxgx_xian # 创建业务库 shell > createdb sde_dxgx # 创建空间库 shell > pg_restore -f dxgx_xian /var/lib/postgres/backup/dxgx_xian-2023-06-07-21-00-00.dmp shell > pg_restore -f sde_dxgx /var/lib/postgres/backup/sde_dxgx-2023-06-07-21-00-00.dmp 检查管线数据与业务数据正常，重新发布管线二维地图服务，测试管线系统正常加载，统计、查询等功能都正常使用。 5.3 查找原因 分析系统日志，使用journalctl查询系统出错日志信息，但因系统文件损坏导致6月9日相关系统日志未能记录和写入，无法查到具体日志信息 分析命令历史，使用history查找命令使用历史，未查找到有用信息 服务器存储还未做坏道测试，如有需要可安排进行一次检查 6 总计 事发突然，说明应急手段不全及相关技术基础支持掌握不到位。以下为相关建议：
...</p></div><footer class=entry-footer><span title='2024-03-10 11:04:49 +0800 CST'>March 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;153 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to 操作系统级故障总结" href=http://localhost:1313//posts/other/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BA%A7%E6%95%85%E9%9A%9C%E6%80%BB%E7%BB%93/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>debian升级内核</h2></header><div class=entry-content><p>最近碰到搭建测试k8s环境，系统版本太低导致很多问题，进行google后整理的升级步骤，供参考。 1. 查看内核版本 uname -msr 2. 更新软件版本 sudo yum -y update 3. 导入eplr rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org 4. ELRepo yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm 5. 查找现有内核版本 yum list available --disablerepo='*' --enablerepo=elrepo-kernel * ML为主线版本，LT为长期支持版本 6. 安装内核版本 sudo yum --enablerepo=elrepo-kernel install kernel-lt 7. 删除旧版本tools yum remove kernel-tools-libs.x86_64 kernel.x86_64 -y yum remove kernel-tools-libs.x86_64 kernel-tools.x86_64 -y 8. 安装工具包 yum --disablerepo=\* --enablerepo=elrepo-kernel install kernel-lt-tools.x86_64 -y 9. 重启手动选择内核进入系统检查系统情况 reboot 10. 查看所有启动内核 awk -F \' '$1=="menuentry " {print i++ " : " $2}' /etc/grub2.cfg 修改默认启动内核：grub2-set-default 0 11. 编辑启动顺序 sudo vim /etc/default/grub --------------------- * Once the file opens, look for the line that says GRUB_DEFAULT=X, and change it to GRUB_DEFAULT=0 (zero). * This line will instruct the boot loader to default to the first kernel on the list, which is the latest. 将GRUB_DEFAULT=X 修改成GRUB_DEFAULT=0 加载第一个内核版本并且为最后一个版本 12. 更新启动配置文件 sudo grub2-mkconfig -o /boot/grub2/grub.cfg 13. 查看启动顺序 grub2-editenv list 14. 重启验证 reboot</p></div><footer class=entry-footer><span title='2024-02-10 11:04:49 +0800 CST'>February 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;137 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to debian升级内核" href=http://localhost:1313//posts/linux/debian%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>docker-compose下容器启动顺序控制</h2></header><div class=entry-content><p>情况说明： docker-compose中检测服务启动后的状态，也是最近碰到了业务中需要控制服务状态启动顺序，翻阅官方、google和群友帮助研究出此文。 不同于depends_on此种方式只是启动顺序配置，不管服务状态是否启动，要检测服务中的状态还需要借助第三方脚本或者其他程序，官方有推荐wait-for-it, dockerize,wait-for, RelayAndContainers等方式。 本文件使用wait 提供的程序进行检测和启动,github地址为：https://github.com/ufoscout/docker-compose-wait；也是可以参考官方使用方法，rust编写的二进制文件无依赖，直接执行。 具体步骤： 1. 下载程序 (通过离线方式进行下载封装，具体原因不解释。) wget -O https://github.com/ufoscout/docker-compose-wait/releases/download/2.9.0/wait 2. dockerfile封装 FROM openjdk:8-jdk-alpine LABEL "maintainer"="sergio13848.com" LABEL "rating"="chinadci" "class"="pipe2d3d" ENV JVM_XMS="1g" \ JVM_XMX="1g" \ JVM_XMN="512m" \ JVM_MS="128m" \ JVM_MMS="320m" RUN apk add --update tzdata && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \ && echo "Asia/Shanghai" > /etc/timezone \ && apk del tzdata \ && apk add --update --no-cache bash VOLUME [ "/opt/2d3d" ] WORKDIR /data COPY *.jar pipe2d3d.jar COPY bootstrap.yml bootstrap.yml COPY run.sh . COPY wait . # 拷贝wait程序至容器 RUN chmod +x run.sh \ && chmod +x wait # 赋予执行权限 EXPOSE 29670 CMD ./wait && ./run.sh 3. 修改docker-compose配置方式 nacos: image: nacos/nacos-server:2.0.2 container_name: nacos privileged: true restart: always env_file: - ./env/nacos-standlone-mysql.env volumes: - ./nacos/standalone-logs/:/home/nacos/logs ports: - 8848:8848 - 9848:9848 - 9555:9555 depends_on: - mysql ------- 2d3d: build: ./2d3d/ image: chinadci/2d3d:latest container_name: chinadci-2d3d privileged: true restart: always ports: - 29670:29670 volumes: - ./2d3d:/data environment: WAIT_HOSTS: nacos:8848 # 此处配置需要等待的服务(为容器启动后的服务器名称和端口号)， 还有启动参数可以参考github介绍 depends_on: - nacos 4. 配置成功效果 ...</p></div><footer class=entry-footer><span title='2024-02-10 11:04:49 +0800 CST'>February 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;167 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to docker-compose下容器启动顺序控制" href=http://localhost:1313//posts/docker/docker_start/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Dockerfile文件编写</h2></header><div class=entry-content><p>情况说明： 公司业务最近正在转型中，从传统模式转变到微服务架构设计，最终落到docker的方式进行服务打包部署。后期随着规模扩大也有可能使用k8s方式进行业务扩充，直至SaaS方式提供专有服务。 研发部分目前感觉只专注于自己的业务开发，基础设施服务方面没有过多涉及，遂着手进行Dockerfile文件编写打包服务，项目以Spring Boot开发方式为主。 具体步骤: 1. 获取应用程序 结构如下
2. dockerfile编写 FROM openjdk:8-jdk-alpine # 使用alpine版本作为基础镜像 LABEL "maintainer"="sergio13848.com" # 设置标签 LABEL "rating"="chinadci" "class"="pipe2d3d" # 设置标签 RUN apk add --update tzdata && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \ && echo "Asia/Shanghai" > /etc/timezone \ && apk del tzdata \ && apk add --update --no-cache bash # 安装tzdata设定时区 VOLUME [ "/opt/2d3d" ] # 设置挂载目录 WORKDIR /data # 设置工作目录 COPY *.jar pipe2d3d.jar COPY bootstrap.yml bootstrap.yml COPY run.sh . COPY wait . #拷贝源码到工作目录下 RUN chmod +x run.sh \ && chmod +x wait # 给予运行参数 EXPOSE 29670 # 服务暴露端口号 CMD ./wait && ./run.sh # 运行，wait为检测服务状态是否就绪，上个章节有讲 3. run.sh编写 使用运行脚本与docker封装脱离
...</p></div><footer class=entry-footer><span title='2024-02-10 11:04:49 +0800 CST'>February 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;145 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to Dockerfile文件编写" href=http://localhost:1313//posts/docker/dockerfile%E7%BC%96%E5%86%99/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>postgresql简单记录备份</h2></header><div class=entry-content><p>备份 pg_dump -F c -F 路径/testdb.dmp -h 127.0.0.1 -U postgres testdb
恢复 pg_restore -d testdb testdb.dmp -h 127.0.0.1 -U postgres
数据库归档模式： 1. 修改postgresql.conf文件中的相关参数，包括： archive_mode = on # 开启归档模式，可以是off, on, 或者always archive_command = ‘DATE=`date +%Y%m%d`;DIR=/var/lib/postgresql/arch/$DATE;test ! -d $DIR && mkdir -p $DIR;test ! -f $DIR/%f && cp %p $DIR/%f’ # 指定归档命令，可以是一个shell命令或者脚本，其中%p表示WAL文件的完整路径，%f表示WAL文件的名称 wal_level = replica # 或者logical，指定WAL日志的输出级别，minimal不支持归档 2. 创建归档目录，并赋予postgres用户相应的权限，例如： mkdir -p /var/lib/postgresql/arch chown -R postgres.postgres /var/lib/postgresql/arch/ 3. 重启PostgreSQL服务，使配置生效，例如： service postgresql-13 restart 4. 验证归档模式是否开启成功，可以通过以下方法： 查看archive_mode参数的值，应该是on或者always 手动切换WAL日志文件，使用select pg_switch_wal()命令，并查看归档目录是否有新的WAL文件生成 查看日志文件中是否有归档相关的信息或者错误 备份脚本 #!/bin/bash BACKUP_LOCAL_DIR=/opt/local BACKUP_CON_DIR=/opt/con BACKUP_DAY=7 #数据库名称 DB_NAME_dev=dev_dotnet TODAY=`data +%Y-%m-%d` #删除超过7天的备份 find $BACKUP_LOCAL_DIR -type f -name dev_dotent* -mtime +BACKUP_DAY -exec rm -rf {} \; #进行数据备份 sudo docker exec -it postgres pg_dump -F c -f $BACKUP_CON_DIR/dev_dotnet_$TODAY.dmp -h 127.0.0.1 -U postgres dev_dotnet #压缩备份文件 sudo gzip $BACKUP_LOCAL_DIR/dev_dotnet_$TODAY.dmp #显示备份成功 echo "$DB_NAME_dev $TODAY 数据库备份成功！" #归档日志处理 vi postgresql.conf archive_mode = on archive_command = 'DATE=`date +%Y%m%d`; DIR="/var/lib/postgresql/arch/$DATE"; test ! -d $DIR && mkdir -p $DIR; test ! -f $DIR/%f && cp %p %DIR/%f; find /var/lib/postgresql/arch/ -type d -mtime 7 -exec rm -f {} \;'</p></div><footer class=entry-footer><span title='2024-02-10 11:04:49 +0800 CST'>February 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;161 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to postgresql简单记录备份" href=http://localhost:1313//posts/postgres/postgers%E5%A4%87%E4%BB%BD%E5%9B%9E%E5%A4%8D/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>virtualenv虚拟环境使用</h2></header><div class=entry-content><p>python的虚拟环境有很多选择，今天只记录virtualenv简单使用
1. 安装virtualenv pip install virtualenv 2. 创建虚拟环境并指定python版本,会在本目录下创建下虚拟环境 virtualenv venv --python=pythonx.x.x 3. 进入虚拟环境 source venv/bin/activate 4. 退出虚拟环境 deactivate 5. 删除虚拟环境 rm -rf venv</p></div><footer class=entry-footer><span title='2024-02-10 11:04:49 +0800 CST'>February 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;23 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to virtualenv虚拟环境使用" href=http://localhost:1313//posts/python/virtualenv%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>博客内容本地推送至github</h2></header><div class=entry-content><p>1. github创建空的仓库，给予xxxxx.io名字，公开权限 2. 克隆仓库至本地 git clone https://github.com/xxxxxxx 3. 本地hugo环境以及博客创建完成，本地关联远程github仓库 git remote add origin git@github.com:miawithcode/xxxxx 4. 本地编辑完的博客内容实用如下命令进行提交至github git pull --rebase origin main # 首次与远端同步 git add . git commit -m "...(修改的信息)" git push origin main</p></div><footer class=entry-footer><span title='2024-02-10 11:04:49 +0800 CST'>February 10, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;34 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to 博客内容本地推送至github" href=http://localhost:1313//posts/other/%E5%8D%9A%E5%AE%A2%E5%86%85%E5%AE%B9%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81%E8%87%B3github/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>sed简单介绍</h2></header><div class=entry-content><p>语法 sed options...[script][inputfile] 第一部分 准备测试数据 cat &lt;&lt;EOF > sedtest.conf unix is great os. unix is opensource. unix is free os. learn operating system. unix linux which one you choose. unix is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. EOF 1. 替换每行第一个字符 $ sed 's/unix/linux/' sedtest.conf Output : linux is great os. unix is opensource. unix is free os. learn operating system. linux linux which one you choose. linux is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. 2. 替换每行第二个字符 $ sed 's/unix/linux/2' sedtest.conf Output : unix is great os. linux is opensource. unix is free os. learn operating system. unix linux which one you choose. unix is easy to learn.linux is a multiuser os.Learn unix .unix is a powerful. 3. 替换每行所有字符 $ sed 's/unix/linux/g' sedtest.conf Output : linux is great os. linux is opensource. linux is free os. learn operating system. linux linux which one you choose. linux is easy to learn.linux is a multiuser os.Learn linux .linux is a powerful. 4. 替换每行第三个开始的字符 $ sed 's/unix/linux/3g' sedtest.conf Output : unix is great os. unix is opensource. linux is free os. learn operating system. unix linux which one you choose. unix is easy to learn.unix is a multiuser os.Learn linux .linux is a powerful. 5. 字符分割加符号 $ echo "Welcome To The Geek Stuff" | sed 's/\(\b[A-Z]\)/\(\1\)/g' Output : (W)elcome (T)o (T)he (G)eek (S)tuff 6. 替换第几行的第一个字符(第三行) $ sed '3 s/unix/linux' sedtest.conf Output : unix is great os. unix is opensource. unix is free os. learn operating system. linux linux which one you choose. unix is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. 7. 显示被替换的行内容(被替换的显示双行，没有替换的显示原始数据) $ sed 's/unix/linux/p' sedtest.conf Output : linux is great os. unix is opensource. unix is free os. linux is great os. unix is opensource. unix is free os. learn operating system. linux linux which one you choose. linux linux which one you choose. linux is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. linux is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. 8. 只显示被替换的内容 $ sed -n 's/unix/linux/p' sedtest.conf Output : linux is great os. unix is opensource. unix is free os. linux linux which one you choose. linux is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. 9. 替换给定行数字符 $ sed '1,3 s/unix/linux/' sedtest.conf Output : linux is great os. unix is opensource. unix is free os. learn operating system. linux linux which one you choose. unix is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful. $ sed '2,$ s/unix/linux/' geekfile.txt Output : unix is great os. unix is opensource. unix is free os. learn operating system. linux linux which one you choose. linux is easy to learn.unix is a multiuser os.Learn unix .unix is a powerful *** $ 代表文件最后一行内容 *** 10. 删除行内容 语法：$ sed 'nd' filename.txt 例子：$ sed '5d' filename.txt $ sed '$d' filename.txt //删除最后一行内容 $ sed 'x,yd' filename.txt //删除x到y之间行内容 sed '3,6d' filename.txt $ sed 'nth,$d' filename.txt // 删除第几行到最后一行 sed '12,$d' filename.txt $ sed '/pattern/d' filename.txt //删除匹配到行 sed '/abc/d' filename.txt 第二部分 准备测试数据 cat &lt;&lt;EOF > sedtest.txt life isn't meant to be easy, life is meant to be lived. Try to learn & understand something new everyday in life. Respect everyone & most important love everyone. Don’t hesitate to ask for love & don’t hesitate to show love too. Life is too short to be shy. In life, experience will help you differentiating right from wrong. EOF 文件间距处理 1. 每行最后插入一个空白行 $ sed G sedtest.txt Output: life isn't meant to be easy, life is meant to be lived. Try to learn & understand something new everyday in life. Respect everyone & most important love everyone. Don’t hesitate to ask for love & don’t hesitate to show love too. Life is too short to be shy. In life, experience will help you differentiating right from wrong. 2. 插入2行空白行 sed 'G;G' sedtest.txt 3. 删除空白行，在每行后面插入空白行 sed '/^$/d;G' sedtest.txt 4. 在匹配行上面插入一条黑线(匹配love) sed '/love/{x;p;x;}' sedtest.txt 5. 在匹配行下面插入空白行(匹配love) sed '/love/G' sedtest.txt 6. 在每行左边插入5个空格 sed 's/^/ /' sedtest.txt 编号处理 1. 每一行进行编号(左对齐)，\t为数字跟语句之间的制表符 sed = a.txt | sed 'N;s/\n/\t' 2. 每行插入编号(数字左边，右对齐)，类似于cat -n filename 增加编号效果 sed '/./=' a.txt | sed 'N;s/^/ ;s/*\(.\{4,\}\)\n/\1 /' 3. 不为空行进行编号 sed '/./=' a.txt | sed '/./N; s/\n/ /' 删除行 1. 删除指定行数 sed '5d' a.txt //删除第五行 2. 删除最后一行 sed '$d' a.txt //$ 代表最后一行 3. 删除指定范围行数内容 sed '3,5d' a.txt //删除第3-5行内容 4.删除置指定行数到最后一行 sed '2,$d' a.txt //第二行到最后一行 5. 删除匹配内容行内容 sed '/life/d' a.txt 6. 删除从第n行开始的2行内容 sed '3~2d' a.txt 7. 删除匹配内容及其后的两行 sed '/easy/,+2d' a.txt 8. 删除空白行 sed '^$/d' a.txt 9. 删除空白行及#开始内容 sed -i '/^#/d;/^$/d' a.txt 查看打印文件 1. 查看指定范围行数内容 sed -n '2,5p' a.txt 2. 查看指定范围外内容 sed '2,4d' a.txt 3. 查看文件第几行 sed -n '4'p a.txt //第4行内容 4. 查看指定范围内内容 sed -n '4,6'p a.txt 5. 查看最后一行内容 sed -n '$'p a.txt 6. 查看指定行术到最后一行内容 sed -n '3,$'p a.txt //第三行到最后一行 7 打印匹配内容行内容 sed -n /every/p a.txt 8. 打印匹配内容到到第n行 sed -n '/everyone/,5p' a.txt //从匹配行打印到第5行 9. 打印从第x行开始直到匹配的行内容 sed -n ‘x,/pattern/p’ filename sed -n '1,/everyone/p' a.txt 10. 打印匹配的行直到第x行 sed -n '/pattern/,+xp' filename sde -n '/learn/,+2p' a.txt 替换命令 1. 替换第一次出现的内容 sed 's/life/leaves/' a.txt 2. 替换一行中第x次出现内容 sed 's/to/two/2' a.txt 3. 替换所有内容 sed 's/life/learn/g' a.txt 4. 替换从第x开始的字符 sed 's/to/TWO/2g' a.txt 5. 替换第x行内容 sed '3 s/every/each/' a.txt sed '3 s/every/each/p' a.txt //打印 6. 替换指定范围内行内容 sed '2,5 s/to/TWO/' a.txt 7. 替换内容忽略大小写 sed 's/life/Love/i' a.txt sed 's/[Ll]ife/Love/g' a.txt //匹配life、Life替换内容 8. 使用一个空格替换所有 sed 's/ */ /g' filename 9. 使用一种匹配模式替换另一个内容 Syntax: sed ‘/followed_pattern/ s/old_pattern/new_pattern/’ filename sed '/is/ s/live/love' a.txt //匹配第一个内容去替换 10. 除过第x行 sed -i '5!s/life/love' a.txt //第5行除过</p></div><footer class=entry-footer><span title='2023-09-10 11:04:49 +0800 CST'>September 10, 2023</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;901 words&nbsp;·&nbsp;langhaidian</footer><a class=entry-link aria-label="post link to sed简单介绍" href=http://localhost:1313//posts/linux/sed/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=http://localhost:1313/posts/>«&nbsp;Prev&nbsp;</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>langhaidian</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>